English version is [here](./README_en.md)

`sst((simple stack trace))` æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é›¶ä¾èµ–ã€**header-only** çš„ C++ æ ˆå›æº¯åº“ï¼Œä¸“ä¸ºä½ä¾µå…¥ã€é«˜å…¼å®¹æ€§è€Œè®¾è®¡ã€‚å®ƒæ”¯æŒï¼š

- âœ… **ä¸ä¾èµ– DWARF**ï¼šä»…ä½¿ç”¨ç¬¦å·è¡¨ï¼ˆ`.symtab` / `.dynsym`ï¼‰ï¼Œä¸ä¾èµ– dwarf è°ƒè¯•ä¿¡æ¯
- âœ… **pie / no-pie**ï¼šè‡ªåŠ¨è¯†åˆ«ä¸»ç¨‹åºæ˜¯å¦ pie ç±»å‹ï¼Œå‡†ç¡®å¤„ç†åœ°å€é‡å®šä½
- âœ… **é™æ€ / åŠ¨æ€é“¾æ¥**ï¼šåœ¨ `-static`ã€`-no-pie`ã€`-pie`ã€`-lxxx` ç­‰æ„å»ºä¸‹å‡å¯æ­£å¸¸å·¥ä½œ
- âœ… **åŠ¨æ€åº“è§£æ**ï¼šæ”¯æŒ `dlopen()` åŠ¨æ€åŠ è½½æ¨¡å—çš„ç¬¦å·è§£æ
- âœ… **C API å¯¼å‡º**ï¼šå¯é€šè¿‡ `libsst.so` / `libsst.a` æä¾›ç»™çº¯ C é¡¹ç›®è°ƒç”¨

---



## ğŸ“ é¡¹ç›®ç»“æ„

```

.
â”œâ”€â”€ include/
â”‚   â””â”€â”€ sst.hpp          # âœ… æ ¸å¿ƒå¤´æ–‡ä»¶ï¼Œheader-onlyï¼Œå¯ç›´æ¥å¼•å…¥ä½¿ç”¨
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ sst.cpp          # ğŸ” C API å®ç°
â”‚   â””â”€â”€ sst.h            # ğŸ” C API å¤´æ–‡ä»¶ï¼ˆä¾¿äºå…¶ä»–è¯­è¨€å¦‚ Python FFIï¼‰
â”œâ”€â”€ exmaple/
â”‚   â””â”€â”€ \*.cpp            # ğŸ“¦ å¤šç§æ„å»ºé…ç½®ä¸‹çš„ä¾‹å­ï¼ˆpie / no-pie / static / shared / dlopen ç­‰ï¼‰
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ test\_capi.c      # ğŸ§ª ä½¿ç”¨ C API çš„æµ‹è¯•ç¨‹åº
â””â”€â”€ README.md            # ğŸ“– å½“å‰æ–‡æ¡£

````

---



## ğŸ”§ å¿«é€Ÿå¼€å§‹ï¼ˆC++ï¼‰

ä½ åªéœ€ä¸€ä¸ªå¤´æ–‡ä»¶ï¼š

```cpp
#include "sst.hpp"

int main() {
    stacktrace::Stacktrace st = stacktrace::Stacktrace::capture();
    st.print();  // è¾“å‡ºå½“å‰æ ˆå¸§
}
````

---



## ğŸŒ C API ç”¨æ³•

ä½ å¯ä»¥æ„å»º `libsst.a` æˆ– `libsst.so` æ¥ä¸º C é¡¹ç›®æˆ–å…¶ä»–è¯­è¨€æä¾›æ”¯æŒï¼š

```c
#include "sst.h"

int main() {
    sst_backtrace trace;
    sst_capture(&trace);
    sst_print(&trace);
    return 0;
}
```

æ„å»ºå‚è€ƒï¼š

```bash
cd src && make       # æ„å»ºé™æ€å’ŒåŠ¨æ€åº“

# å¦‚æœæƒ³è¦æµ‹è¯•
cd test && make      # ç¼–è¯‘ C æµ‹è¯•ä»£ç 
```

---



## ğŸ’¡ ç¤ºä¾‹è¿è¡Œ

ä½ å¯ä»¥å‚è€ƒ `exmaple/` ç›®å½•ä¸­çš„æ ·ä¾‹æµ‹è¯•ä¸åŒæ„å»ºé…ç½®ä¸‹çš„è¡Œä¸ºï¼š

* `pie.cpp`, `nopie.cpp`, `static.cpp`ï¼šæµ‹è¯•ä¸»ç¨‹åºæ„å»ºæ–¹å¼
* `pie_dlopen.cpp`, `nopie_dlopen.cpp`ï¼šæµ‹è¯• `dlopen()` åœºæ™¯
* `*_shared*.cpp`ï¼šæµ‹è¯•é“¾æ¥åŠ¨æ€åº“åèƒ½å¦æˆåŠŸå›æº¯åº“ä¸­å‡½æ•°

---



## ğŸ› ï¸ æŠ€æœ¯åŸç†

* ä½¿ç”¨ `dl_iterate_phdr` éå†æ‰€æœ‰åŠ è½½æ¨¡å—ï¼ˆåŒ…æ‹¬ä¸»ç¨‹åºå’ŒåŠ¨æ€åº“ï¼‰
* åŸºäº ELF æ–‡ä»¶æ ¼å¼è§£æ `.symtab` å’Œ `.dynsym`
* PIE ç¨‹åºä½¿ç”¨ `dlpi_addr + st_value`ï¼Œé PIE ç›´æ¥ä½¿ç”¨ `st_value`
* å¯¹äº no-pie å’Œ static æ„å»ºï¼ŒåŸºåœ°å€é€šè¿‡ `/proc/self/maps` è§£æå‡º


## ğŸ“¬ è”ç³»ä½œè€…
æ¬¢è¿æ Issue æˆ– PR è¿›è¡Œåé¦ˆä¸è´¡çŒ®ï¼ˆå¦‚æœä»£ç æœ‰ bugï¼Œè¯·åŠ¡å¿…å‘Šè¯‰æˆ‘ğŸ˜˜ï¼‰ï¼
